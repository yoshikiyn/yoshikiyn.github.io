<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>管理者画面 - ポイント管理</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .admin-row { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #ccc; align-items: center; }
        .admin-row strong { font-size: 1.2em; color: #28a745; margin-right: 10px; }
        button { padding: 5px 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>管理者用パネル</h1>
        <p>各チームのポイントを操作・確認できます。</p>
        <div id="admin-list">
            Loading...
        </div>
        <hr>
        <p style="font-size: 0.9em; color: #666;">※ config.js の設定を読み込んでいます</p>
    </div>

    <script type="module">
        // ▼ config.js から初期化済みのDBとチーム情報を読み込む
        import { db, TEAMS } from './config.js';
        // ▼ 操作に必要な関数だけCDNから読み込む
        import { ref, onValue, set } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

        const listDiv = document.getElementById('admin-list');

        // データの監視（リアルタイム更新）
        onValue(ref(db, 'teams'), (snapshot) => {
            const data = snapshot.val() || {};
            listDiv.innerHTML = "";

            // config.js の TEAMS 定義に基づいてループ
            Object.keys(TEAMS).forEach(teamId => {
                // DBにデータがない場合は0を表示
                const points = (data[teamId] && data[teamId].points !== undefined) ? data[teamId].points : 0;
                
                const row = document.createElement('div');
                row.className = "admin-row";
                row.innerHTML = `
                    <span>${TEAMS[teamId].name} <small>(${teamId})</small></span>
                    <div>
                        <strong>${points} P</strong>
                        <button onclick="window.updatePoints('${teamId}', ${points})">変更</button>
                    </div>
                `;
                listDiv.appendChild(row);
            });
        });

        // ポイント変更処理
        window.updatePoints = (teamId, currentVal) => {
            const newVal = prompt(`${TEAMS[teamId].name} の新しいポイントを入力してください`, currentVal);
            
            // キャンセルでも空欄でもない場合のみ更新
            if (newVal !== null && newVal.trim() !== "") {
                const intVal = parseInt(newVal);
                if (!isNaN(intVal)) {
                    set(ref(db, `teams/${teamId}/points`), intVal)
                        .catch(err => alert("エラーが発生しました: " + err));
                } else {
                    alert("半角数字を入力してください");
                }
            }
        }
    </script>
</body>
</html>
